var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*-=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\*\-\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};"use strict";var DEFAULT_NOTEPAD_HEIGHT="200";var DEFAULT_NOTEPAD_WIDTH="750";var AUTOSAVE_SECONDS=60;var AUTOSAVE_MAX_SIZE=32000;var INDICATOR_FEEDBACK_SECONDS=6;var PROGRESS_IMG_URL="img/waiting.gif";var MAX_NOTEPAD_SIZE=900000;var globalUsername="";var globalPassword="";var autosaveTimer;var statusTimer;var progressBar;var apiMutex=false;function resetStatusIndicator(){var b="#f8f8f8";var a="#d8d8d8";document.getElementById("status-box").style.borderTop="2px solid "+b;document.getElementById("status-box").style.borderBottom="2px solid "+a}function setStatusIndicator(b,a){document.getElementById("status-box").style.borderTop="2px solid "+b;document.getElementById("status-box").style.borderBottom="2px solid "+b;clearTimeout(statusTimer);if(a==true){statusTimer=setTimeout(function(){resetStatusIndicator()},INDICATOR_FEEDBACK_SECONDS*1000)}}function showStatusBox(){document.getElementById("status-box").style.display="block";document.getElementById("page-content").style.paddingTop="10px"}function hideStatusBox(){document.getElementById("status-box").style.display="none";document.getElementById("page-content").style.paddingTop="25px"}function setStatusText(a,b){if(document.getElementById("status-box").style.display=="none"){showStatusBox()}switch(a){case"none":break;case"success":setStatusIndicator("#22bb22",true);break;case"failure":setStatusIndicator("#bb2222",true);break;case"alert":setStatusIndicator("#aa4000",true);break}document.getElementById("status-text").innerHTML=b}function setWaitingIndicator(a){var b=document.getElementById("progress-indicator");if(b){if(a===true){b.innerHTML="<img src='"+PROGRESS_IMG_URL+"' height='16' width='16' alt='Processing request' title='Processing request' />"}else{b.innerHTML=""}}}function adjustNotepadSize(f,b,d){var c,a,e;if(b>3000){b=3000}if(d>3000){d=3000}c=document.getElementById("notepad");switch(f){case"set":if(b===0){a=DEFAULT_NOTEPAD_HEIGHT}else{a=b}c.style.height=a+"px";if(d===0){e=DEFAULT_NOTEPAD_WIDTH}else{e=d}c.style.width=e+"px";break;case"increment":if(b!==0){b+=parseInt((c.style.height).replace("px",""),10);c.style.height=b+"px"}if(d!==0){d+=parseInt((c.style.width).replace("px",""),10);c.style.width=d+"px"}break}}function setNotepadFontColor(a){document.getElementById("notepad").style.color=a;document.getElementById("font-colors").value=a}function setNotepadBackgroundColor(a){document.getElementById("notepad").style.backgroundColor=a;document.getElementById("background-colors").value=a}function setBodyToLogin(){document.getElementById("notepad-block").style.display="none";document.getElementById("login-block").style.display="block"}function setBodyToNotepad(){document.getElementById("login-block").style.display="none";document.getElementById("notepad-block").style.display="block"}function resetNotepad(){adjustNotepadSize("set",DEFAULT_NOTEPAD_HEIGHT,DEFAULT_NOTEPAD_WIDTH);document.getElementById("autosave").checked=false}function autosaveNotepad(a){if(document.getElementById("autosave").checked===true){if(document.getElementById("notepad").value.length>AUTOSAVE_MAX_SIZE){document.getElementById("autosave").checked=false;setStatusText("alert","Looks like you're making good use of your notepad. :-) You're welcome to store lots of text, but auto-save is disabled for large notepads. You can continue to save manually and re-enable auto-save once the notepad is smaller.")}else{saveNotepadApi("auto",a)}}}function autosaveThread(a){if(a==="start"){clearInterval(autosaveTimer);autosaveTimer=setInterval(function(){autosaveNotepad()},AUTOSAVE_SECONDS*1000)}else{if(a==="stop"){clearInterval(autosaveTimer)}}}function resetFrontPage(){setBodyToLogin();resetNotepad();hideStatusBox();document.getElementById("front-page-header").innerHTML="Login to My Notepad Info";document.getElementById("username").focus();window.location.hash=""}function logout(){var b,a,c;autosaveThread("stop");autosaveNotepad(false);globalUsername="";globalPassword="";b=document.getElementById("notepad");b.value="";a=document.createElement("textarea");a.value="";c=document.getElementById("notepad-block");c.replaceChild(a,b);a.id="notepad";resetFrontPage()}function onPageLoad(){}function onPageUnload(){if(globalUsername!==""){autosaveNotepad(false)}}function getXmlTagNode(a,c){try{return a.getElementsByTagName(c)[0].childNodes[0].nodeValue}catch(b){console.error("Failed to extract XML node: "+c)}}function setApiMutex(){apiMutex=true}function clearApiMutex(){apiMutex=false}function isApiMutexOn(){return apiMutex}function handleApiResponse(b,d){var a,c;setWaitingIndicator(false);clearApiMutex();if(b.status==200){a=true;c=b.responseXML;try{c.getElementsByTagName("response_code")[0].childNodes[0].nodeValue}catch(f){a=false}if(a){d(c)}else{setStatusText("failure","Sorry, we could not complete your request due to a server error.");console.error("Malformed response from server: "+b.responseText)}}else{setStatusText("failure","<b>HTTP error, status =  "+b.status+"</b> - "+b.responseText+"<br />* Please  <a href='about.php'>report</a> this error status to the admin staff.")}}function sendApiQuery(g,b,f,d){var a,c;if(isApiMutexOn()===true){return false}setApiMutex();if(typeof d==="undefined"){d=true}try{a=new XMLHttpRequest()}catch(h){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(h){setStatusText("failure","Sorry, your browser doesn't support AJAX so this site won't work for you. Try using a browser such as Firefox 4 or IE 7 or greater.");return false}}a.open("POST","/api/api.php",d);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.setRequestHeader("Content-length",g.length);a.setRequestHeader("Connection","close");a.send(g);setWaitingIndicator(true);if(b!==""){setStatusText("none",b)}if(d===true){a.onreadystatechange=function(){if(a.readyState==4){handleApiResponse(a,f)}}}else{handleApiResponse(a,f)}}function loginApiResponseHandler(c){var f="";switch(getXmlTagNode(c,"response_code")){case"success":try{globalUsername=Base64.decode(getXmlTagNode(c,"username"));globalPassword=document.getElementById("password").value;document.getElementById("username").value="";document.getElementById("password").value="";document.getElementById("front-page-header").innerHTML="Hello, "+globalUsername+"!";adjustNotepadSize("set",getXmlTagNode(c,"height"),getXmlTagNode(c,"width"));setNotepadFontColor(getXmlTagNode(c,"font_color"));setNotepadBackgroundColor(getXmlTagNode(c,"background_color"));if(getXmlTagNode(c,"autosave")==="true"){document.getElementById("autosave").checked=true}else{document.getElementById("autosave").checked=false}var b=c.getElementsByTagName("notepad_data")[0].childNodes.length;for(var a=0;a<b;a++){f+=c.getElementsByTagName("notepad_data")[0].childNodes[a].nodeValue}document.getElementById("notepad").value=Base64.decode(f);setBodyToNotepad();window.location.hash="form-top";document.getElementById("notepad").focus();autosaveThread("start")}catch(d){setStatusText("failure","Sorry, a server error occured while logging you in.")}break;case"failure":document.getElementById("username").value="";document.getElementById("password").value="";document.getElementById("username").focus();break}setStatusText(getXmlTagNode(c,"response_code"),getXmlTagNode(c,"status"))}function loginApi(){var a;a="action=login&username="+Base64.encode(document.getElementById("username").value)+"&password="+Base64.encode(document.getElementById("password").value);sendApiQuery(a,"Logging in.",loginApiResponseHandler)}function registerUserApiResponseHandler(b){var a;document.getElementById("password").value="";document.getElementById("password2").value="";a=getXmlTagNode(b,"response_code");if(a==="failure"){document.getElementById("username").focus()}setStatusText(a,getXmlTagNode(b,"status"))}function registerUserApi(){var a;if(document.getElementById("username").value===""){setStatusText("failure","You must specify a username.");return}if(document.getElementById("password").value!==document.getElementById("password2").value){setStatusText("failure","Error: Your passwords do not match.");document.getElementById("password").value="";document.getElementById("password2").value="";document.getElementById("password").focus();return}a="action=register&username="+Base64.encode(document.getElementById("username").value)+"&password="+Base64.encode(document.getElementById("password").value)+"&email="+Base64.encode(document.getElementById("email").value);sendApiQuery(a,"Processing registration.",registerUserApiResponseHandler)}function resetPasswordApiResponseHandler(a){setStatusText(getXmlTagNode(a,"response_code"),getXmlTagNode(a,"status"))}function resetPasswordApi(){var a;if(document.getElementById("username").value===""){setStatusText("failure","Please specify a username to reset their password.");return}a="action=reset_pwd&username="+Base64.encode(document.getElementById("username").value);sendApiQuery(a,"Resetting password.",resetPasswordApiResponseHandler)}function changeProfileApiResponseHandler(b){var a=getXmlTagNode(b,"response_code");switch(a){case"success":document.getElementById("old_password").value="";document.getElementById("new_password").value="";document.getElementById("new_password2").value="";break;case"failure":document.getElementById("old_password").value="";document.getElementById("username").focus();break}setStatusText(a,getXmlTagNode(b,"status"))}function changeProfileApi(){var a,c,b;if(document.getElementById("username").value===""){setStatusText("failure","You must specify a username.");return}c=document.getElementById("new_password").value;b=document.getElementById("new_password2").value;if(c!==b){setStatusText("failure","Your passwords do not match.");document.getElementById("new_password").value="";document.getElementById("new_password2").value="";document.getElementById("new_password").focus();return}a="action=change_profile&username="+Base64.encode(document.getElementById("username").value)+"&old_password="+Base64.encode(document.getElementById("old_password").value)+"&new_password="+Base64.encode(document.getElementById("new_password").value)+"&new_email="+Base64.encode(document.getElementById("new_email").value);sendApiQuery(a,"Changing password.",changeProfileApiResponseHandler)}function submitFeedbackApiResponseHandler(a){setStatusText(getXmlTagNode(a,"response_code"),getXmlTagNode(a,"status"))}function submitFeedbackApi(){var a;if(document.getElementById("message").value===""){setStatusText("failure","You need to enter a message. Just tell me what you think.");return}a="action=submit_feedback&name="+Base64.encode(document.getElementById("name").value)+"&email="+Base64.encode(document.getElementById("email").value)+"&subject="+Base64.encode(document.getElementById("subject").value)+"&message="+Base64.encode(document.getElementById("message").value);sendApiQuery(a,"Submitting feedback.",submitFeedbackApiResponseHandler)}function saveNotepadApiResponseHandler(d){var c,b,a,e;switch(getXmlTagNode(d,"response_code")){case"success":b=new Date();a=b.getHours();e=b.getMinutes();if(e<10){e="0"+e}if(a>12){c=(a-12)+":"+e+" PM."}else{if(a===12){c="12:"+e+" PM."}else{if(a>0&&a<12){c=a+":"+e+" AM."}else{if(a===0){c="12:"+e+" AM."}}}}setStatusText("none",getXmlTagNode(d,"status")+"<span style='white-space: nowrap;'>at "+c+"</span>");break;case"failure":setStatusText("failure",getXmlTagNode(d,"status"));break}}function saveNotepadApi(c,b){var a;if(typeof b==="undefined"){b=true}if(document.getElementById("notepad").value.length>MAX_NOTEPAD_SIZE){setStatusText("failure","Sorry, your notepad is too long. Please keep it under "+(MAX_NOTEPAD_SIZE/1000)+"k.");return false}a="action=save&mode="+c+"&username="+Base64.encode(globalUsername)+"&password="+Base64.encode(globalPassword)+"&notepad_data="+Base64.encode(document.getElementById("notepad").value)+"&height="+document.getElementById("notepad").style.height.replace("px","")+"&width="+document.getElementById("notepad").style.width.replace("px","")+"&autosave="+document.getElementById("autosave").checked+"&font_color="+document.getElementById("font-colors").value.substr(1,6)+"&background_color="+document.getElementById("background-colors").value.substr(1,6);sendApiQuery(a,"Saving notepad data.",saveNotepadApiResponseHandler,b)}function emailNotepadApiResponseCallback(a){setStatusText(getXmlTagNode(a,"response_code"),getXmlTagNode(a,"status"))}function emailNotepadApi(){var b,d="",a="",c;if(globalUsername!==""){d=globalUsername;a=globalPassword}else{c=document.getElementById("username");if(c){d=document.getElementById("username").value}}if(d===""){setStatusText("failure","Please input your username so we can e-mail your notepad to the e-mail address on record.");return}b="action=email_notepad&username="+Base64.encode(d)+(a?("&password="+Base64.encode(a)):"");sendApiQuery(b,"Finding e-mail address.",emailNotepadApiResponseCallback)}progressBar=new Image(16,16);progressBar.src=PROGRESS_IMG_URL;window.onbeforeunload=function(){onPageUnload()};